# 流水线名称
name: C++ CI

# 触发条件：代码Push到main分支，或提交Pull Request到main分支时触发
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# 任务集合
jobs:
  # 任务名：build-and-test（编译+测试）
  build-and-test:
    # 运行环境：Ubuntu最新版（Linux系统，编译C++方便）
    runs-on: ubuntu-latest

    # 任务步骤
    steps:
      # 步骤1：拉取代码到运行环境
      - name: Checkout code
        uses: actions/checkout@v4  # 用官方的checkout动作，v4是最新版

      # 步骤2：安装C++编译环境和Google Test框架
      - name: Install dependencies
        run: |
          sudo apt-get update  # 更新软件源
          sudo apt-get install -y g++ cmake libgtest-dev  # 安装g++（编译器）、cmake（构建工具）、Google Test
          # 编译并安装Google Test（Ubuntu的libgtest-dev只是源码，需要手动编译）
          cd /usr/src/gtest
          sudo cmake CMakeLists.txt
          sudo make
          sudo cp lib/libgtest* /usr/lib/

      # 步骤3：编译C++项目
      - name: Build project
        run: |
          g++ -std=c++11 main.cpp test.cpp -o test -lgtest -lgtest_main -pthread  # 编译命令（-lgtest链接Google Test库，-pthread是线程库）

      # 步骤4：运行单元测试
      - name: Run tests
        run: ./test  # 执行编译后的测试程序
